/**
 * Parses the page and the css generated by glamor
 * and finds all inline font families that were used in it and appends them to head
 */

import { getStore } from "visual/redux/store";
import Config from "visual/global/Config";
import { makeFontsUrl, makeRichTextFontFamiliesCSS } from "visual/utils/fonts";

export default function addFonts($head) {
  const configFonts = Config.get("fonts");
  const { extraFonts = [] } = getStore().getState().globals.project;
  const fontsToLoad = [...configFonts, ...extraFonts];

  const fontsUrl = makeFontsUrl(fontsToLoad);
  $head.append(`<link type="text/css" rel="stylesheet" href="${fontsUrl}" />`);

  const richTextFamiliesCSS = makeRichTextFontFamiliesCSS(fontsToLoad);
  $head.append(`<style>${richTextFamiliesCSS}</style>`);
}
